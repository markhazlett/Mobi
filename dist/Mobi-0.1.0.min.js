/*! Mobi - v0.1.0 - 2013-02-01
* Copyright (c) 2013 Mark Hazlett; Licensed MIT */
window.Mobi=window.Mobi||{},Mobi.Navigator={backButtonFlag:!0,history:[],directions:{UP:"UP",DOWN:"DOWN",LEFT:"LEFT",RIGHT:"RIGHT"},opposites:{UP:"DOWN",DOWN:"UP",LEFT:"RIGHT",RIGHT:"LEFT"},animations:{SLIDE_STACK:"SLIDE_STACK",SLIDE_OVER:"SLIDE_OVER"},navigate:function(e,t){return this.history.push(t),this.backButtonFlag=!1,Backbone.history.navigate(e,t)},renderView:function(e,t){var n,r;return n=this.history.length>0?this.history[this.history.length-1].animation:null,n?(r=$("<div></div>"),this.resetContent(r,t),this.normalRenderView(r,t),this.animate(e,r,n.type,n.direction),this.afterAnimation()):(this.resetContent(e,t),this.normalRenderView(e,t))},normalRenderView:function(e,t){return e.append(t.render().el)},resetContent:function(e){return e.html("")},afterAnimation:function(){var e,t,n=this.history.pop();e=n.animation,t=this.opposites[e.direction],n.animation.direction=t,this.history.push(n),this.backButtonFlag&&this.history.pop(),this.backButtonFlag=!0},animate:function(e,t,n,r){if(this.animations.hasOwnProperty(n))return this.doAnimation(e,t,n,r);throw Error("Animation Not Available")},doAnimation:function(e,t,n,r){var i,s;return $("#app-container").prepend(t),t.addClass("animate-to-view").addClass(r).addClass("initial"),$("#app-container").addClass("animate"),$("#app-container").addClass(r),s=function(){return t.removeClass("initial")},setTimeout(s,1),i=function(){return e.remove(),t.attr("id","app-main"),t.removeClass("animate-to-view").removeClass(r),$("#app-container").removeClass("animate").removeClass(r)},setTimeout(i,400)}},window.Mobi.Router=Backbone.Router.extend({renderView:function(e){return Mobi.Navigator.renderView($("#app-main"),e)}}),Mobi.View=Backbone.View.extend({delegateEvents:function(e){var t,n,r;this.events=this.events||e;for(t in this.events)t.indexOf("click")===0&&Modernizr.touch&&(n=t.replace("click","touchend"),r=this.events[t],this.events[n]=r,delete this.events[t]);return Backbone.View.prototype.delegateEvents.call(this,this.events)}});